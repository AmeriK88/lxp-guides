{% extends "layouts/dashboard_base.html" %}
{% block title %}Experiencias{% endblock %}

{% block dashboard_content %}
  <div class="flex flex-col gap-6">

    {% url 'experiences:list' as experiences_list_url %}

    {% with create_experience_url="" %}
      {% if user.is_authenticated and user.is_guide and user.guide_profile.verification_status == "verified" %}
        {% url 'experiences:create' as create_experience_url %}
      {% endif %}

      {% include "components/section_header.html" with title="Experiencias en Lanzarote" subtitle="Explora rutas, volcanes, calas y planes √∫nicos con gu√≠as locales." cta_url=create_experience_url cta_label="+ Crear experiencia" %}
    {% endwith %}

    <!-- Filters -->
    <div class="card">
      <div class="card-body">
        <div class="mb-4">
          <h2 class="text-base font-semibold">Buscar y filtrar</h2>
          <p class="mt-1 text-sm text-slate-600">Ajusta tu b√∫squeda y ordena resultados.</p>
        </div>

        <form method="get" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-6">
          <div class="lg:col-span-2">
            <label class="label">Buscar</label>
            <input class="input" type="text" name="q" value="{{ filters.q }}" placeholder="Timanfaya, volcanes, senderismo...">
          </div>

          <div class="lg:col-span-2">
            <label class="label">Categor√≠a</label>
            <select class="input" name="category">
              <option value="">Todas</option>
              {% for c in categories %}
                <option value="{{ c.slug }}" {% if filters.category == c.slug %}selected{% endif %}>
                  {{ c.name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="label">Precio m√≠n (‚Ç¨)</label>
            <input class="input" type="number" step="0.01" name="min_price" value="{{ filters.min_price }}">
          </div>

          <div>
            <label class="label">Precio m√°x (‚Ç¨)</label>
            <input class="input" type="number" step="0.01" name="max_price" value="{{ filters.max_price }}">
          </div>

          <div class="lg:col-span-2">
            <label class="label">Duraci√≥n m√°x (min)</label>
            <input class="input" type="number" name="max_duration" value="{{ filters.max_duration }}" placeholder="Ej: 180">
          </div>

          <div class="lg:col-span-2">
            <label class="label">Ordenar</label>
            <select class="input" name="sort">
              <option value="recent" {% if filters.sort == "recent" %}selected{% endif %}>M√°s recientes</option>
              <option value="popular" {% if filters.sort == "popular" %}selected{% endif %}>M√°s populares</option>
              <option value="price_asc" {% if filters.sort == "price_asc" %}selected{% endif %}>Precio: menor a mayor</option>
              <option value="price_desc" {% if filters.sort == "price_desc" %}selected{% endif %}>Precio: mayor a menor</option>
              <option value="duration_asc" {% if filters.sort == "duration_asc" %}selected{% endif %}>Duraci√≥n: menor a mayor</option>
              <option value="duration_desc" {% if filters.sort == "duration_desc" %}selected{% endif %}>Duraci√≥n: mayor a menor</option>
            </select>
          </div>

          <div class="lg:col-span-2 flex items-end gap-2">
            <button type="submit" class="btn btn-primary w-full">Aplicar</button>
            <a href="{{ experiences_list_url }}" class="btn btn-ghost w-full text-center">Limpiar</a>
          </div>
        </form>
      </div>
    </div>
    {% if has_filters %}
      {% include "components/experience_grid.html" with experiences=experiences empty_title="Ups‚Ä¶ no encontramos nada üòÖ" empty_text="Prueba con otros t√©rminos o limpia los filtros." empty_cta_url=experiences_list_url empty_cta_label="Limpiar filtros" %}
    {% else %}
      {% include "components/experience_grid.html" with experiences=experiences empty_title="No hay experiencias activas todav√≠a" empty_text="Vuelve m√°s tarde o ajusta los filtros." empty_cta_url=experiences_list_url empty_cta_label="Ver experiencias" %}
    {% endif %}
  </div>
{% endblock %}
