{% extends "layouts/dashboard_base.html" %}
{% block title %}Experiencias{% endblock %}

{% block dashboard_content %}
  <div class="flex flex-col gap-6">
    <!-- Header -->
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 class="text-2xl font-semibold tracking-tight">Experiencias en Lanzarote</h1>
        <p class="mt-1 text-sm text-slate-600">
          Explora rutas, volcanes, calas y planes √∫nicos con gu√≠as locales.
        </p>
      </div>

      {% if user.is_authenticated and user.is_guide and user.guide_profile.verification_status == "verified" %}
        <a href="{% url 'experiences:create' %}" class="btn btn-primary">
          + Crear experiencia
        </a>
      {% endif %}
    </div>

    <!-- Filters -->
    <div class="card">
      <div class="card-body">
        <div class="mb-4">
          <h2 class="text-base font-semibold">Buscar y filtrar</h2>
          <p class="mt-1 text-sm text-slate-600">Ajusta tu b√∫squeda y ordena resultados.</p>
        </div>

        <form method="get" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-6">
          <div class="lg:col-span-2">
            <label class="label">Buscar</label>
            <input
              class="input"
              type="text"
              name="q"
              value="{{ filters.q }}"
              placeholder="Timanfaya, volcanes, senderismo..."
            >
          </div>

          <div class="lg:col-span-2">
            <label class="label">Categor√≠a</label>
            <select class="input" name="category">
              <option value="">Todas</option>
              {% for c in categories %}
                <option value="{{ c.slug }}" {% if filters.category == c.slug %}selected{% endif %}>
                  {{ c.name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="label">Precio m√≠n (‚Ç¨)</label>
            <input class="input" type="number" step="0.01" name="min_price" value="{{ filters.min_price }}">
          </div>

          <div>
            <label class="label">Precio m√°x (‚Ç¨)</label>
            <input class="input" type="number" step="0.01" name="max_price" value="{{ filters.max_price }}">
          </div>

          <div class="lg:col-span-2">
            <label class="label">Duraci√≥n m√°x (min)</label>
            <input class="input" type="number" name="max_duration" value="{{ filters.max_duration }}" placeholder="Ej: 180">
          </div>

          <div class="lg:col-span-2">
            <label class="label">Ordenar</label>
            <select class="input" name="sort">
              <option value="recent" {% if filters.sort == "recent" %}selected{% endif %}>M√°s recientes</option>
              <option value="popular" {% if filters.sort == "popular" %}selected{% endif %}>M√°s populares</option>
              <option value="price_asc" {% if filters.sort == "price_asc" %}selected{% endif %}>Precio: menor a mayor</option>
              <option value="price_desc" {% if filters.sort == "price_desc" %}selected{% endif %}>Precio: mayor a menor</option>
              <option value="duration_asc" {% if filters.sort == "duration_asc" %}selected{% endif %}>Duraci√≥n: menor a mayor</option>
              <option value="duration_desc" {% if filters.sort == "duration_desc" %}selected{% endif %}>Duraci√≥n: mayor a menor</option>
            </select>
          </div>

          <div class="lg:col-span-2 flex items-end gap-2">
            <button type="submit" class="btn btn-primary w-full">Aplicar</button>
            <a href="{% url 'experiences:list' %}" class="btn btn-ghost w-full text-center">Limpiar</a>
          </div>
        </form>

        {% if filters.q or filters.category or filters.min_price or filters.max_price or filters.max_duration or filters.sort != "recent" %}
          <div class="mt-4 flex flex-wrap gap-2">
            <span class="text-sm text-slate-600">Filtros activos:</span>
            {% if filters.q %}<span class="badge">üîé {{ filters.q }}</span>{% endif %}
            {% if filters.category %}<span class="badge">üóÇ {{ filters.category }}</span>{% endif %}
            {% if filters.min_price %}<span class="badge">üí∂ min {{ filters.min_price }}</span>{% endif %}
            {% if filters.max_price %}<span class="badge">üí∂ max {{ filters.max_price }}</span>{% endif %}
            {% if filters.max_duration %}<span class="badge">‚è± ‚â§ {{ filters.max_duration }} min</span>{% endif %}
            {% if filters.sort and filters.sort != "recent" %}<span class="badge">‚Üï {{ filters.sort }}</span>{% endif %}
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Results -->
    {% if experiences %}
      <div class="mt-5 grid gap-6 sm:grid-cols-2 lg:grid-cols-3 auto-rows-[1fr]">

        {% for experience in experiences %}
          {% include "components/experience_card.html" with experience=experience %}
        {% endfor %}
      </div>
    {% else %}
      <div class="card">
        <div class="card-body">
          <h3 class="text-base font-semibold">No hay experiencias activas todav√≠a</h3>
          <p class="mt-1 text-sm text-slate-600">
            Vuelve m√°s tarde o ajusta los filtros.
          </p>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}
