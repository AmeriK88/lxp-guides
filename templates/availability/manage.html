{% extends "layouts/dashboard_base.html" %}
{% load form_tags %}

{% block title %}Disponibilidad{% endblock %}

{% block dashboard_content %}
  <div class="flex flex-col gap-6">
    <!-- Header -->
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Disponibilidad</h1>
      <p class="mt-1 text-sm text-slate-600">
        Gestiona reglas y bloqueos para la experiencia:
        <span class="font-medium text-slate-900">{{ experience.title }}</span>
      </p>
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
      <!-- Reglas -->
      <div class="card">
        <div class="card-body">
          <h2 class="text-base font-semibold">Reglas</h2>
          <p class="mt-1 text-sm text-slate-600">
            Define horarios, capacidad y restricciones generales.
          </p>

          <form method="post" class="mt-5 space-y-4">
            {% csrf_token %}

            {% for field in form %}
              <div>
                <label class="label">{{ field.label }}</label>
                {{ field|add_class:"input" }}

                {% if field.help_text %}
                  <p class="help">{{ field.help_text|safe }}</p>
                {% endif %}

                {% if field.errors %}
                  <p class="mt-1 text-xs text-red-600">{{ field.errors|striptags }}</p>
                {% endif %}
              </div>
            {% endfor %}

            <button type="submit" class="btn btn-primary w-full">
              Guardar reglas
            </button>
          </form>
        </div>
      </div>

      <!-- Bloqueos -->
      <div class="card">
        <div class="card-body">
          <h2 class="text-base font-semibold">Bloqueos por fecha</h2>
          <p class="mt-1 text-sm text-slate-600">
            Bloquea d√≠as concretos por descanso, clima u otros motivos.
          </p>

          <form method="post" action="{% url 'availability:add_block' experience.id %}" class="mt-5 space-y-4">
            {% csrf_token %}

            {% for field in block_form %}
              <div>
                <label class="label">{{ field.label }}</label>
                {{ field }}

                {% if field.help_text %}
                  <p class="help">{{ field.help_text|safe }}</p>
                {% endif %}

                {% if field.errors %}
                  <p class="mt-1 text-xs text-red-600">{{ field.errors|striptags }}</p>
                {% endif %}
              </div>
            {% endfor %}

            <button type="submit" class="btn btn-dark w-full">
              Bloquear fecha
            </button>
          </form>

          <div class="mt-6 border-t border-slate-200 pt-4">
            <h3 class="text-sm font-semibold text-slate-800">Fechas bloqueadas</h3>

            {% if blocks %}
              <ul class="mt-3 space-y-2">
                {% for b in blocks %}
                  <li class="flex items-start justify-between gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3">
                    <div>
                      <p class="text-sm font-medium text-slate-900">{{ b.date }}</p>
                      {% if b.reason %}
                        <p class="mt-1 text-sm text-slate-600">{{ b.reason }}</p>
                      {% endif %}
                    </div>

                    <a href="{% url 'availability:delete_block' b.id %}"
                       class="btn btn-ghost px-3 py-1.5 text-red-700 hover:bg-red-50">
                      Eliminar
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="mt-2 text-sm text-slate-600">No hay fechas bloqueadas.</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
