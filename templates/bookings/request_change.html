{% extends "layouts/dashboard_base.html" %}
{% load form_tags %}

{% block title %}Solicitar cambio{% endblock %}

{% block dashboard_content %}
<div class="flex flex-col gap-6">
  <div>
    <h1 class="h1-page">Solicitar cambio</h1>
    <p class="mt-1 p-muted">
      Envía una solicitud al guía. No se aplicará hasta que la acepte.
    </p>
  </div>

  <div class="card">
    <div class="card-body">
      <form method="post" class="grid gap-4 sm:grid-cols-2">
        {% csrf_token %}

        {# Errores generales (non-field) también arriba #}
        {% if form.non_field_errors %}
          <div class="form-error sm:col-span-2" role="alert">
            {{ form.non_field_errors|striptags }}
          </div>
        {% endif %}

        <!-- Fecha -->
        <div class="sm:col-span-2">
          <label class="label">Fecha</label>

          {{ form.date|add_class:"input js-booking-date" }}

          <div id="booking-calendar-config"
               data-disabled-dates-url="{% url 'availability:experience_disabled_dates' booking.experience.id %}">
          </div>

          {% if form.date.errors %}
            <p class="field-error">{{ form.date.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Adultos -->
        <div>
          <label class="label">Adultos</label>
          {{ form.adults|add_class:"input" }}
          {% if form.adults.errors %}
            <p class="field-error">{{ form.adults.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Niños -->
        <div>
          <label class="label">Niños</label>
          {{ form.children|add_class:"input" }}
          {% if form.children.errors %}
            <p class="field-error">{{ form.children.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Bebés -->
        <div>
          <label class="label">Bebés</label>
          {{ form.infants|add_class:"input" }}
          {% if form.infants.errors %}
            <p class="field-error">{{ form.infants.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Transporte -->
        <div>
          <label class="label">Transporte</label>
          {{ form.transport_mode|add_class:"input" }}
          {% if form.transport_mode.errors %}
            <p class="field-error">{{ form.transport_mode.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Recogida -->
        <div class="sm:col-span-2">
          <label class="label">Lugar de encuentro / recogida</label>
          {{ form.pickup_notes|add_class:"input" }}
          {% if form.pickup_notes.errors %}
            <p class="field-error">{{ form.pickup_notes.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Idioma -->
        <div class="sm:col-span-2">
          <label class="label">Idioma preferido</label>
          {{ form.preferred_language|add_class:"input" }}
          {% if form.preferred_language.errors %}
            <p class="field-error">{{ form.preferred_language.errors|striptags }}</p>
          {% endif %}
        </div>

        <!-- Notas -->
        <div class="sm:col-span-2">
          <label class="label">Notas</label>
          {{ form.notes|add_class:"input" }}
          {% if form.notes.errors %}
            <p class="field-error">{{ form.notes.errors|striptags }}</p>
          {% endif %}
        </div>

        <div class="sm:col-span-2 flex gap-2">
          <button class="btn btn-primary" type="submit">Enviar solicitud</button>
          <a class="btn btn-ghost" href="{% url 'bookings:detail' booking.pk %}">Volver</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
