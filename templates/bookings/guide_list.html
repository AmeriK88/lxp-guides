{% extends "layouts/dashboard_base.html" %}
{% block title %}Reservas Recibidas{% endblock %}

{% block dashboard_content %}
  <div class="flex flex-col gap-6">
    <!-- Header -->
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Reservas Recibidas</h1>
      <p class="mt-1 text-sm text-slate-600">
        Confirma o rechaza solicitudes y revisa los detalles de cada reserva.
      </p>
    </div>

    {% if bookings %}
      <div class="space-y-3">
        {% for b in bookings %}
          <div class="card">
            <div class="card-body">
              <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
                <!-- Left -->
                <div>
                  <h2 class="text-base font-semibold">
                    <a href="{% url 'experiences:detail' b.experience.pk %}" class="hover:underline">
                      {{ b.experience.title }}
                    </a>
                  </h2>

                  <div class="mt-2 flex flex-wrap gap-2">
                    <span class="badge">ðŸ‘¤ {{ b.traveler.username }}</span>
                    <span class="badge">ðŸ“… {{ b.date }}</span>
                    <span class="badge">ðŸ‘¥ {{ b.people }} personas</span>
                    {% if b.total_price %}
                      <span class="badge">ðŸ’¶ {{ b.total_price }}â‚¬</span>
                    {% endif %}
                  </div>

                  {% if b.guide_response %}
                    <p class="mt-2 text-sm text-slate-600">
                      ðŸ’¬ {{ b.guide_response|truncatechars:80 }}
                    </p>
                  {% endif %}
                </div>

                <!-- Right -->
                <div class="flex flex-col items-start gap-2 sm:items-end">
                  {% with s=b.status|lower %}
                    {% if s == "accepted" %}
                      <span class="badge badge-amber">Aceptada</span>
                    {% elif s == "pending" %}
                      <span class="badge">Pendiente</span>
                    {% elif s == "rejected" %}
                      <span class="badge" style="border-color: rgb(254 202 202); background-color: rgb(254 242 242); color: rgb(153 27 27);">
                        Rechazada
                      </span>
                    {% elif s == "canceled" %}
                      <span class="badge" style="border-color: rgb(254 202 202); background-color: rgb(254 242 242); color: rgb(153 27 27);">
                        Cancelada
                      </span>
                    {% else %}
                      <span class="badge">{{ b.status }}</span>
                    {% endif %}
                  {% endwith %}

                  <div class="flex flex-wrap gap-2">
                    <a href="{% url 'bookings:detail' b.pk %}" class="btn btn-ghost">Ver reserva</a>

                    {% if b.status == "pending" %}
                      <a href="{% url 'bookings:accept' b.pk %}" class="btn btn-primary">
                        Aceptar con mensaje
                      </a>
                      <a href="{% url 'bookings:reject' b.pk %}"
                        class="btn btn-ghost"
                        style="border-color: rgb(254 202 202); background-color: rgb(254 242 242); color: rgb(153 27 27);">
                        Rechazar con motivo
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

    {% else %}
      <div class="card">
        <div class="card-body">
          <h2 class="text-base font-semibold">No tienes reservas todavÃ­a</h2>
          <p class="mt-1 text-sm text-slate-600">
            Cuando un viajero reserve una experiencia, aparecerÃ¡ aquÃ­ para gestionarla.
          </p>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}
