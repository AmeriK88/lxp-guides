{% extends "layouts/base.html" %}

{% block body %}
  <div class="mx-auto max-w-6xl px-4 py-6 sm:px-6">
    <div class="flex min-h-[75vh] flex-col gap-4 lg:flex-row">
      <!-- Sidebar -->
      <aside class="w-full lg:w-64 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm" data-animate="fade-right">
        <div class="mb-4">
          <h2 class="text-base font-semibold">Panel</h2>
          <p class="mt-1 text-sm text-slate-500">Navegaci칩n r치pida</p>
        </div>

        <nav class="space-y-1 text-sm">
          <a href="{% url 'pages:dashboard' %}"
             class="block rounded-lg px-3 py-2 font-medium
             {% if request.resolver_match.url_name == 'dashboard' %}
               bg-blue-50 text-blue-700
             {% else %}
               text-slate-700 hover:bg-slate-100
             {% endif %}">
            Dashboard
          </a>

          <a href="{% url 'pages:profile' %}"
             class="block rounded-lg px-3 py-2 font-medium
             {% if request.resolver_match.url_name == 'profile' %}
               bg-blue-50 text-blue-700
             {% else %}
               text-slate-700 hover:bg-slate-100
             {% endif %}">
            Mi Perfil
          </a>

          {% if user.is_authenticated %}
            {% if user.is_guide %}
              <a href="{% url 'experiences:list' %}"
                 class="block rounded-lg px-3 py-2 font-medium
                 {% if request.resolver_match.app_name == 'experiences' %}
                   bg-blue-50 text-blue-700
                 {% else %}
                   text-slate-700 hover:bg-slate-100
                 {% endif %}">
                Mis Experiencias
              </a>

              <a href="{% url 'bookings:guide_list' %}"
                 class="block rounded-lg px-3 py-2 font-medium
                 {% if request.resolver_match.url_name == 'guide_list' %}
                   bg-blue-50 text-blue-700
                 {% else %}
                   text-slate-700 hover:bg-slate-100
                 {% endif %}">
                <span class="flex items-center justify-between">
                  <span>Reservas Recibidas</span>

                  {% with n=unseen_guide_bookings|default:0 %}
                    {% if n %}
                      <span class="ml-2 inline-flex items-center rounded-full bg-blue-600 px-2 py-0.5 text-xs font-semibold text-white">
                        {{ n }}
                      </span>
                    {% endif %}
                  {% endwith %}
                </span>
              </a>

            {% else %}
              <a href="{% url 'experiences:list' %}"
                 class="block rounded-lg px-3 py-2 font-medium
                 {% if request.resolver_match.app_name == 'experiences' %}
                   bg-blue-50 text-blue-700
                 {% else %}
                   text-slate-700 hover:bg-slate-100
                 {% endif %}">
                Explorar
              </a>

              <a href="{% url 'bookings:traveler_list' %}"
                 class="block rounded-lg px-3 py-2 font-medium
                 {% if request.resolver_match.url_name == 'traveler_list' %}
                   bg-blue-50 text-blue-700
                 {% else %}
                   text-slate-700 hover:bg-slate-100
                 {% endif %}">
                <span class="flex items-center justify-between">
                  <span>Mis Reservas</span>

                  {% with n=unseen_traveler_bookings|default:0 %}
                    {% if n %}
                      <span class="ml-2 inline-flex items-center rounded-full bg-blue-600 px-2 py-0.5 text-xs font-semibold text-white">
                        {{ n }}
                      </span>
                    {% endif %}
                  {% endwith %}
                </span>
              </a>

              <!-- NEW: Reviews (traveler only) -->
              <a href="{% url 'reviews:my_reviews' %}"
                 class="block rounded-lg px-3 py-2 font-medium
                 {% if request.resolver_match.app_name == 'reviews' and request.resolver_match.url_name == 'my_reviews' %}
                   bg-blue-50 text-blue-700
                 {% else %}
                   text-slate-700 hover:bg-slate-100
                 {% endif %}">
                Mis rese침as
              </a>
            {% endif %}
          {% endif %}
        </nav>

        <div class="mt-4 border-t border-slate-200 pt-4 space-y-2">
          {% if user.is_authenticated %}
            <a href="{% url 'accounts:logout' %}"
              class="block rounded-lg bg-slate-900 px-3 py-2 text-center text-sm font-medium text-white hover:bg-slate-800">
              Salir
            </a>
          {% else %}
            <a href="{% url 'accounts:login' %}"
              class="block rounded-lg bg-blue-600 px-3 py-2 text-center text-sm font-medium text-white hover:bg-blue-500">
              Iniciar sesi칩n
            </a>
            <a href="{% url 'accounts:register' %}"
              class="block rounded-lg px-3 py-2 text-center text-sm font-medium text-slate-700 hover:bg-slate-100 border border-slate-200">
              Crear cuenta
            </a>
          {% endif %}
        </div>
      </aside>

      <!-- Content -->
      <section class="flex-1 w-full min-w-0 max-w-full overflow-x-hidden rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 shadow-sm" data-animate="scale-in">
        {% block dashboard_content %}{% endblock %}
      </section>

    </div>
  </div>
{% endblock %}
